/*
HPAM: Hirshfeld Partitioned Atomic Multipoles
Copyright (C) 2011  Dennis M. Elking

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/

#include <stdio.h>
#include <stdlib.h> 
#include <string.h> 
#include <math.h> 


#include "Read_Input_Library.h"
#include "Allocate.h"
#include "Math_Functions.h"
#include "Lebedev.h"


#define Pi 3.1415926535897932384626433832




void Set_a1 (double a1[6][3]);
void Set_a2 (double a2[12][3]);
void Set_a3 (double a3[8][3]);
void Set_bk (double bk[24][3], double mk);
void Set_ck (double ck[24][3], double pk);
void Set_dk (double dk[48][3], double rk, double uk);

double Set_v_2_p (double v);

void Set_Lebedev_Grid_Parm (int index1, int index2, struct LEB_Data *leb, int DEBUG, FILE *fp_debug);
void Calc_Lebedev_Grid (int *n_pt, double ***r2d, double **weight, struct LEB_Data *leb);


void Set_Lebedev_Grid_Parm (int index1, int index2, struct LEB_Data *leb, int DEBUG, FILE *fp_debug)
/*Defines Lebedev Angular Grid Parameters in terms of constants defined in Lebedev's papers*/
{
	int i;
	double tau;
	double D1_131[] = {
			0.8143252820767350*1.0E-4, 0.9998859890887728*1.0E-4, 0.1156199403068359*1.0E-3, 0.1287632092635513*1.0E-3, 
			0.1398378643365139*1.0E-3, 0.1491876468417391*1.0E-3, 0.1570855679175456*1.0E-3, 0.1637483948103775*1.0E-3, 
			0.1693500566632843*1.0E-3, 0.1740322769393633*1.0E-3, 0.1779126637278296*1.0E-3, 0.1810908108835412*1.0E-3, 
			0.1836529132600190*1.0E-3, 0.1856752841777379*1.0E-3, 0.1872270566606832*1.0E-3, 0.1883722645591307*1.0E-3, 
			0.1891714324525297*1.0E-3, 0.1896827480450146*1.0E-3, 0.1899628417059528*1.0E-3, 0.1123301829001669*1.0E-3, 
			0.1253698826711277*1.0E-3, 0.1366266117678531*1.0E-3, 0.1462736856106918*1.0E-3, 0.1545076466685412*1.0E-3, 
			0.1615096280814007*1.0E-3, 0.1674366639741759*1.0E-3, 0.1724225002437900*1.0E-3, 0.1765810822987288*1.0E-3, 
			0.1800104126010751*1.0E-3, 0.1827960437331284*1.0E-3, 0.1850140300716308*1.0E-3, 0.1867333507394938*1.0E-3, 
			0.1880178688638289*1.0E-3, 0.1889278925654758*1.0E-3, 0.1895213832507346*1.0E-3, 0.1898548277397420*1.0E-3, 
			0.1349105935937341*1.0E-3, 0.1444060068369326*1.0E-3, 0.1526797390930008*1.0E-3, 0.1598208771406474*1.0E-3, 
			0.1659354368615331*1.0E-3, 0.1711279910946440*1.0E-3, 0.1754952725601440*1.0E-3, 0.1791247850802529*1.0E-3, 
			0.1820954300877716*1.0E-3, 0.1844788524548449*1.0E-3, 0.1863409481706220*1.0E-3, 0.1877433008795068*1.0E-3, 
			0.1887444543705232*1.0E-3, 0.1894009829375006*1.0E-3, 0.1897683345035198*1.0E-3, 0.1517327037467653*1.0E-3, 
			0.1587740557483543*1.0E-3, 0.1649093382274097*1.0E-3, 0.1701915216193265*1.0E-3, 0.1746847753144065*1.0E-3, 
			0.1784555512007570*1.0E-3, 0.1815687562112174*1.0E-3, 0.1840864370663302*1.0E-3, 0.1860676785390006*1.0E-3, 
			0.1875690583743703*1.0E-3, 0.1886453236347225*1.0E-3, 0.1893501123329645*1.0E-3, 0.1897366184519868*1.0E-3, 
			0.1643908815152736*1.0E-3, 0.1696300350907768*1.0E-3, 0.1741553103844483*1.0E-3, 0.1780015282386092*1.0E-3, 
			0.1812116787077125*1.0E-3, 0.1838323158085421*1.0E-3, 0.1859113119837737*1.0E-3, 0.1874969220221698*1.0E-3, 
			0.1886375612681076*1.0E-3, 0.1893819575809276*1.0E-3, 0.1897794748256767*1.0E-3, 0.1738963926584846*1.0E-3, 
			0.1777442359873466*1.0E-3, 0.1810010815068719*1.0E-3, 0.1836920318248129*1.0E-3, 0.1858489473214328*1.0E-3, 
			0.1875079342496592*1.0E-3, 0.1887080239102310*1.0E-3, 0.1894905752176822*1.0E-3, 0.1898991061200695*1.0E-3, 
			0.1809065016458791*1.0E-3, 0.1836297121596799*1.0E-3, 0.1858426916241869*1.0E-3, 0.1875654101134641*1.0E-3, 
			0.1888240751833503*1.0E-3, 0.1896497383866979*1.0E-3, 0.1900775530219121*1.0E-3, 0.1858525041478814*1.0E-3, 
			0.1876248690077947*1.0E-3, 0.1889404439064607*1.0E-3, 0.1898168539265290*1.0E-3, 0.1902779940661772*1.0E-3, 
			0.1890125641731815*1.0E-3, 0.1899434637795751*1.0E-3, 0.1904520856831751*1.0E-3, 0.1905534498734563*1.0E-3}; 
	double u_131[] = {
			0.06095964259104373, 0.08811962270959388, 0.1165936722428831, 0.1460232857031785, 
			0.1761197110181755, 0.2066471190463718, 0.2374076026328152, 0.2682305474337051, 
			0.2989653312142369, 0.3294762752772209, 0.3596390887276086, 0.3893383046398812, 
			0.4184653789358347, 0.4469172319076166, 0.4745950813276976, 0.5014034601410262, 
			0.5272493404551239, 0.5520413051846366, 0.5756887237503077, 0.1225039430588352, 
			0.1539113217321372, 0.1856213098637712, 0.2174998728035131, 0.2494128336938330, 
			0.2812321562143480, 0.3128372276456111, 0.3441145160177973, 0.3749567714853510, 
			0.4052621732015610, 0.4349335453522385, 0.4638776641524965, 0.4920046410462687, 
			0.5192273554861704, 0.5454609081136522, 0.5706220661424140, 0.5946286755181518, 
			0.1905370790924295, 0.2242518717748009, 0.2577190808025936, 0.2908724534927187, 
			0.3236354020056219, 0.3559267359304543, 0.3876637123676956, 0.4187636705218842, 
			0.4491449019883107, 0.4787270932425445, 0.5074315153055574, 0.5351810507738336, 
			0.5619001025975381, 0.5875144035268046, 0.6119507308734495, 0.2619733870119463, 
			0.2968149743237949, 0.3310451504860488, 0.3646215567376676, 0.3974916785279360, 
			0.4295967403772029, 0.4608742854473447, 0.4912598858949903, 0.5206882758945558, 
			0.5490940914019819, 0.5764123302025542, 0.6025786004213506, 0.6275291964794956, 
			0.3348189479861771, 0.3699515545855295, 0.4042003071474669, 0.4375320100182624, 
			0.4699054490335947, 0.5012739879431952, 0.5315874883754966, 0.5607937109622117, 
			0.5888393223495521, 0.6156705979160163, 0.6412338809078123, 0.4076051259257167, 
			0.4423788125791520, 0.4760480917328258, 0.5085838725946297, 0.5399513637391218, 
			0.5701118433636380, 0.5990240530606021, 0.6266452685139695, 0.6529320971415942, 
			0.4791583834610126, 0.5130373952796940, 0.5456252429628476, 0.5768956329682385, 
			0.6068186944699046, 0.6353622248024907, 0.6624927035731797, 0.5484933508028488, 
			0.5810207682142106, 0.6120955197181352, 0.6416944284294319, 0.6697926391731260, 
			0.6147594390585488, 0.6455390026356783, 0.6747258588365477, 0.6772135750395347};
	double v_131[] = {
			0.1787828275342931*1.0E-1, 0.3953888740792096*1.0E-1, 0.6378121797722990*1.0E-1, 0.8985890813745037*1.0E-1, 
			0.1172606510576162*1.0E00, 0.1456102876970995*1.0E00, 0.1746153823011775*1.0E00, 0.2040383070295584*1.0E00, 
			0.2336788634003698*1.0E00, 0.2633632752654219*1.0E00, 0.2929369098051601*1.0E00, 0.3222592785275512*1.0E00, 
			0.3512004791195743*1.0E00, 0.3796385677684537*1.0E00, 0.4074575378263879*1.0E00, 0.4345456906027828*1.0E00, 
			0.4607942515205134*1.0E00, 0.4860961284181720*1.0E00, 0.5103447395342790*1.0E00, 0.2136455922655793*1.0E-1, 
			0.4520926166137188*1.0E-1, 0.7086468177864818*1.0E-1, 0.9785239488772918*1.0E-1, 0.1258106396267210*1.0E00, 
			0.1544529125047001*1.0E00, 0.1835433512202753*1.0E00, 0.2128813258619585*1.0E00, 0.2422913734880829*1.0E00, 
			0.2716163748391453*1.0E00, 0.3007127671240280*1.0E00, 0.3294470677216479*1.0E00, 0.3576932543699155*1.0E00, 
			0.3853307059757764*1.0E00, 0.4122425044452694*1.0E00, 0.4383139587781027*1.0E00, 0.4634312536300553*1.0E00, 
			0.2371311537781979*1.0E-1, 0.4917878059254806*1.0E-1, 0.7595498960495142*1.0E-1, 0.1036991083191100*1.0E00, 
			0.1321348584450234*1.0E00, 0.1610316571314789*1.0E00, 0.1901912080395707*1.0E00, 0.2194384950137950*1.0E00, 
			0.2486155334763858*1.0E00, 0.2775768931812335*1.0E00, 0.3061863786591120*1.0E00, 0.3343144718152556*1.0E00, 
			0.3618362729028427*1.0E00, 0.3886297583620408*1.0E00, 0.4145742277792031*1.0E00, 0.2540047186389353*1.0E-1, 
			0.5208107018543989*1.0E-1, 0.7971828470885599*1.0E-1, 0.1080465999177927*1.0E00, 0.1368413849366629*1.0E00, 
			0.1659073184763559*1.0E00, 0.1950703730454614*1.0E00, 0.2241721144376724*1.0E00, 0.2530655255406489*1.0E00, 
			0.2816118409731066*1.0E00, 0.3096780504593238*1.0E00, 0.3371348366394987*1.0E00, 0.3638547827694396*1.0E00, 
			0.2664841935537443*1.0E-1, 0.5424000066843495*1.0E-1, 0.8251992715430854*1.0E-1, 0.1112695182483710*1.0E00, 
			0.1402964116467816*1.0E00, 0.1694275117584291*1.0E00, 0.1985038235312689*1.0E00, 0.2273765660020893*1.0E00, 
			0.2559041492849764*1.0E00, 0.2839497251976899*1.0E00, 0.3113791060500690*1.0E00, 0.2757792290858463*1.0E-1, 
			0.5584136834984293*1.0E-1, 0.8457772087727143*1.0E-1, 0.1135975846359248*1.0E00, 0.1427286904765053*1.0E00, 
			0.1718112740057635*1.0E00, 0.2006944855985351*1.0E00, 0.2292335090598907*1.0E00, 0.2572871512353714*1.0E00, 
			0.2826094197735932*1.0E-1, 0.5699871359683649*1.0E-1, 0.8602712528554394*1.0E-1, 0.1151748137221281*1.0E00, 
			0.1442811654136362*1.0E00, 0.1731930321657680*1.0E00, 0.2017619958756061*1.0E00, 0.2874219755907391*1.0E-1, 
			0.5778312123713695*1.0E-1, 0.8695262371439526*1.0E-1, 0.1160893767057166*1.0E00, 0.1450378826743251*1.0E00, 
			0.2904957622341456*1.0E-1, 0.5823809152617197*1.0E-1, 0.8740384899884715*1.0E-1, 0.2919946135808105*1.0E-1};

	if ( (index1 == 9) && (index2 == 1) )
	{
		(*leb).A1 = 1.0/105.0;
		(*leb).A2 = 0.0;
		(*leb).A3 = 9.0/280.0;

		(*leb).N1 = 0;
	
		(*leb).N2 = 1;
		(*leb).C1 = D_Allocate_1D_Matrix ((*leb).N2);
		(*leb).p  = D_Allocate_1D_Matrix ((*leb).N2);

		(*leb).C1[0] = 1.0/35.0;
		(*leb).p[0]  = Set_v_2_p (1.0/6.0);

		(*leb).N3 = 0;

		(*leb).N_check = 38;
	}
	else if ( (index1 == 9) && (index2 == 2) )
	{
		(*leb).A1 = (11.0 - sqrt(7.0))/315.0;
		(*leb).A2 = 8.0*(5.0 - sqrt(7.0))/945.0;
		(*leb).A3 = 0.0;

		(*leb).N1 = 1;
		(*leb).Bk = D_Allocate_1D_Matrix ((*leb).N1);
		(*leb).mk = D_Allocate_1D_Matrix ((*leb).N1);
		(*leb).Bk[0] = (38.0*sqrt(7.0)+89.0)/7560.0;
/*wrong in text????
		(*leb).mk[0] = sqrt(1.0+9.0*sqrt(7.0) )/3;
*/
		(*leb).mk[0] = 0.836095596749;

		(*leb).N2 = 0;
		(*leb).N3 = 0;

		(*leb).N_check = 42;
	}
	else if ( (index1 == 11) && (index2 == 1) )
	{
		(*leb).A1 = 4.0/315.0;
		(*leb).A2 = 64.0/2835.0;
		(*leb).A3 = 27.0/1280.0;

		(*leb).N1 = 1;
		(*leb).Bk = D_Allocate_1D_Matrix ((*leb).N1);
		(*leb).mk = D_Allocate_1D_Matrix ((*leb).N1);
		(*leb).Bk[0] = 11.0*11.0*11.0*11.0/725760.0;
		(*leb).mk[0] = 3.0/sqrt(11.0);

		(*leb).N2 = 0;
		(*leb).N3 = 0;

		(*leb).N_check = 50;
	}
	else if ( (index1 == 17) && (index2 == 1) )
	{
		tau = 651.0/391.0;

		(*leb).A1 = 8.0*(11509.0*tau-19685.0)/405405.0/(17*tau-31.0);
		(*leb).A2 = 0.0;
		(*leb).A3 = -27.0*(51.0*tau*tau/31.0/31.0 - 104.0*tau/527.0+50.0/17.0/17.0)/20020.0/(tau/31.0-1.0/51.0)/(tau/31.0-1.0/51.0);

		(*leb).N1 = 3;
		(*leb).Bk = D_Allocate_1D_Matrix ((*leb).N1);
		(*leb).mk = D_Allocate_1D_Matrix ((*leb).N1);
		(*leb).Bk[0] = 0.00821173728319;
		(*leb).Bk[1] = 0.00959547133607;
		(*leb).Bk[2] = 0.00994281489118;

		(*leb).mk[0] = 0.965124035087;
		(*leb).mk[1] = 0.828769981253;
		(*leb).mk[2] = 0.215957291846;

		(*leb).N2 = 1;
		(*leb).C1 = D_Allocate_1D_Matrix ((*leb).N2);
		(*leb).p  = D_Allocate_1D_Matrix ((*leb).N2);

		(*leb).C1[0] = 4.0*17.0*17.0*17.0/2027025.0;
		(*leb).p[0]  = Set_v_2_p (3.0/17.0);

		(*leb).N3 = 0;

		(*leb).N_check = 110;
	}
	else if ( (index1 == 23) && (index2 == 1) )
	{

/*
		(*leb).A1 = int_pow (2.0, 7)*73.0/5242545.0;
		(*leb).A2 = int_pow (2.0, 14)*1663.0/int_pow (3.0, 3)/int_pow (11.0, 2)/1458821.0;
		(*leb).A3 = int_pow (3.0, 10)*1599797.0/int_pow (2.0, 9)/173.0/173.0/13.0/13.0/6545.0;
*/
		(*leb).A1 = 1.78234044724*1.0E-3;
		(*leb).A2 = 5.71690594998*1.0E-3;
		(*leb).A3 = 5.57338317884*1.0E-3;

		(*leb).N1 = 4;
		(*leb).Bk = D_Allocate_1D_Matrix ((*leb).N1);
		(*leb).mk = D_Allocate_1D_Matrix ((*leb).N1);
		(*leb).Bk[0] = 5.51877146727*1.0E-3;
		(*leb).Bk[1] = 5.15823771181*1.0E-3;
		(*leb).Bk[2] = 5.60870408259*1.0E-3;
		(*leb).Bk[3] = 4.10677702817*1.0E-3;

		(*leb).mk[0] = 0.777493219315;
		(*leb).mk[1] = 0.912509096867;
		(*leb).mk[2] = 0.314196994183;
		(*leb).mk[3] = 0.982972302707;

		(*leb).N2 = 1;
		(*leb).C1 = D_Allocate_1D_Matrix ((*leb).N2);
		(*leb).p  = D_Allocate_1D_Matrix ((*leb).N2);

		(*leb).C1[0] = int_pow (38.0, 4)/33.0/33.0/int_pow (7.0, 3)/1105.0;
		(*leb).p[0]  = 0.938319218138;

		(*leb).N3 = 1;
		(*leb).D1 = D_Allocate_1D_Matrix ((*leb).N3);
		(*leb).r  = D_Allocate_1D_Matrix ((*leb).N3);
		(*leb).u  = D_Allocate_1D_Matrix ((*leb).N3);
		(*leb).D1[0] = 5.53024891623*1.0E-3;
		(*leb).r[0]  = 0.836036015482;
		(*leb).u[0]  = 0.159041710538;
		(*leb).N_check = 194;
	}
	else if ( (index1 == 25) && (index2 == 1) )
	{
		(*leb).A1 = -5.52263991974*1.0E-2;
		(*leb).A2 =  0.00000000000*1.0E-3;
		(*leb).A3 =  4.45027460745*1.0E-3;

		(*leb).N1 = 5;
		(*leb).Bk = D_Allocate_1D_Matrix ((*leb).N1);
		(*leb).mk = D_Allocate_1D_Matrix ((*leb).N1);
		(*leb).Bk[0] = 3.97640801805*1.0E-3;
		(*leb).Bk[1] = 4.40140065038*1.0E-3;
		(*leb).Bk[2] = 4.49684106792*1.0E-3;
		(*leb).Bk[3] = 5.04915345048*1.0E-3;
		(*leb).Bk[4] = 1.72454435055*1.0E-2;

		(*leb).mk[0] = 0.158302205463;
		(*leb).mk[1] = 0.363485684957;
		(*leb).mk[2] = 0.772289253148;
		(*leb).mk[3] = 0.934317778846;
		(*leb).mk[4] = 0.998367683968;

		(*leb).N2 = 2;
		(*leb).C1 = D_Allocate_1D_Matrix ((*leb).N2);
		(*leb).p  = D_Allocate_1D_Matrix ((*leb).N2);

		(*leb).C1[0] = 5.19806986406*1.0E-3;
		(*leb).C1[1] = 4.23108309536*1.0E-3;
		(*leb).p[0]  = 0.935022745881;
		(*leb).p[1]  = 0.812913653173;

		(*leb).N3 = 1;
		(*leb).D1 = D_Allocate_1D_Matrix ((*leb).N3);
		(*leb).r  = D_Allocate_1D_Matrix ((*leb).N3);
		(*leb).u  = D_Allocate_1D_Matrix ((*leb).N3);
		(*leb).D1[0] = 4.69572097257*1.0E-3;
/*Note r1 is WRONG in paper (0.486466535887) should be (0.486466153588)
rk =  0.486466153588 uk =  0.843636521069 wk =  0.227218180900
*/
		(*leb).r[0]  = 0.486466153588;
		(*leb).u[0]  = 0.843636521069;

		(*leb).N_check = 230;
	}
	else if ( (index1 == 27) && (index2 == 1) )
	{
		(*leb).A1 = -1.31376912733*1.0E-3;
		(*leb).A2 = -2.52272870489*1.0E-3;
		(*leb).A3 =  4.18685388170*1.0E-3;

		(*leb).N1 = 5;
		(*leb).Bk = D_Allocate_1D_Matrix ((*leb).N1);
		(*leb).mk = D_Allocate_1D_Matrix ((*leb).N1);
		(*leb).Bk[0] = 5.31516797782*1.0E-3;
		(*leb).Bk[1] = 4.25613135143*1.0E-3;
		(*leb).Bk[2] = 4.11248239441*1.0E-3;
		(*leb).Bk[3] = 3.59558489976*1.0E-3;
		(*leb).Bk[4] = 4.04714237709*1.0E-3;

		(*leb).mk[0] = 0.0945750764036;
		(*leb).mk[1] = 0.351315128565;
		(*leb).mk[2] = 0.753673939251;
		(*leb).mk[3] = 0.886098344997;
		(*leb).mk[4] = 0.989694807463;
/*Note m5 is WRONG in paper (0.986948074629) should be (0.989694807463)
l5 =  0.101252624857 m5 =  0.989694807463
*/
		(*leb).N2 = 1;
		(*leb).C1 = D_Allocate_1D_Matrix ((*leb).N2);
		(*leb).p  = D_Allocate_1D_Matrix ((*leb).N2);

		(*leb).C1[0] = 4.22958270065*1.0E-3;
		(*leb).p[0]  = 0.850650808352;


		(*leb).N3 = 2;
		(*leb).D1 = D_Allocate_1D_Matrix ((*leb).N3);
		(*leb).r  = D_Allocate_1D_Matrix ((*leb).N3);
		(*leb).u  = D_Allocate_1D_Matrix ((*leb).N3);
		(*leb).D1[0] = 4.07146759383*1.0E-3;
		(*leb).D1[1] = 4.08091422578*1.0E-3;

		(*leb).r[0]  = 0.819343388819;
		(*leb).r[1]  = 0.939227929750;

		(*leb).u[0]  = 0.524493924092;
		(*leb).u[1]  = 0.323348454269;

		(*leb).N_check = 266;
	}
	else if ( (index1 == 29) && (index2 == 1) )
	{
		(*leb).A1 =  8.54591172878*1.0E-4;
		(*leb).A2 =  0.0*1.0E-3;
		(*leb).A3 =  3.59911928502*1.0E-3;

		(*leb).N1 = 6;
		(*leb).Bk = D_Allocate_1D_Matrix ((*leb).N1);
		(*leb).mk = D_Allocate_1D_Matrix ((*leb).N1);
		(*leb).Bk[0] = 3.65004580768*1.0E-3;
		(*leb).Bk[1] = 3.60482260142*1.0E-3;
		(*leb).Bk[2] = 3.57672966173*1.0E-3;
		(*leb).Bk[3] = 3.44978842429*1.0E-3;
		(*leb).Bk[4] = 3.10895312238*1.0E-3;
		(*leb).Bk[5] = 2.35210141366*1.0E-3;

		(*leb).mk[0] = 0.129238672710;
		(*leb).mk[1] = 0.371034178385;
		(*leb).mk[2] = 0.743452042987;
		(*leb).mk[3] = 0.867643624544;
		(*leb).mk[4] = 0.949454317226;
		(*leb).mk[5] = 0.990705621379;

		(*leb).N2 = 2;
		(*leb).C1 = D_Allocate_1D_Matrix ((*leb).N2);
		(*leb).p  = D_Allocate_1D_Matrix ((*leb).N2);

		(*leb).C1[0] = 3.60082093222*1.0E-3;
		(*leb).C1[1] = 2.98234496317*1.0E-3;

		(*leb).p[0]  = 0.820326419828;
		(*leb).p[1]  = 0.964408914879;

		(*leb).N3 = 2;
		(*leb).D1 = D_Allocate_1D_Matrix ((*leb).N3);
		(*leb).r  = D_Allocate_1D_Matrix ((*leb).N3);
		(*leb).u  = D_Allocate_1D_Matrix ((*leb).N3);
		(*leb).D1[0] = 3.57154055427*1.0E-3;
		(*leb).D1[1] = 3.39231220501*1.0E-3;

		(*leb).r[0]  = 0.251003475177;
		(*leb).r[1]  = 0.902442529533;

		(*leb).u[0]  = 0.800072749407;
		(*leb).u[1]  = 0.412772408317;

		(*leb).N_check = 302;
	}
	else if ( (index1 == 41) && (index2 == 1) )
	{

		(*leb).A1 = 0.3095121295*1.0E-3;
		(*leb).A2 = 0.0000000000*1.0E-3;
		(*leb).A3 = 0.1852379698*1.0E-2;

		(*leb).N1 = 9;
		(*leb).Bk = D_Allocate_1D_Matrix ((*leb).N1);
		(*leb).mk = D_Allocate_1D_Matrix ((*leb).N1);
		(*leb).Bk[0] = 0.9764331164*1.0E-3;
		(*leb).Bk[1] = 0.1384737234*1.0E-2;
		(*leb).Bk[2] = 0.1617210647*1.0E-2;
		(*leb).Bk[3] = 0.1749564657*1.0E-2;
		(*leb).Bk[4] = 0.1818471778*1.0E-2;
		(*leb).Bk[5] = 0.1846715956*1.0E-2;
		(*leb).Bk[6] = 0.1852028828*1.0E-2;
		(*leb).Bk[7] = 0.1858812585*1.0E-2;
		(*leb).Bk[8] = 0.1871790639*1.0E-2;

		(*leb).mk[0] = 0.9962781297;
		(*leb).mk[1] = 0.9784805837;
		(*leb).mk[2] = 0.9414141582;
		(*leb).mk[3] = 0.8830787279;
		(*leb).mk[4] = 0.8028368773;
		(*leb).mk[5] = 0.7007685753;
		(*leb).mk[6] = 0.4333738687;
		(*leb).mk[7] = 0.2703560883;
		(*leb).mk[8] = 0.09219040707;

		(*leb).N2 = 3;
		(*leb).C1 = D_Allocate_1D_Matrix ((*leb).N2);
		(*leb).p  = D_Allocate_1D_Matrix ((*leb).N2);

		(*leb).C1[0] = 0.1300321685*1.0E-2;
		(*leb).C1[1] = 0.1705153996*1.0E-2;
		(*leb).C1[2] = 0.1857161196*1.0E-2;

		(*leb).p[0]  = 0.9850133350;
		(*leb).p[1]  = 0.9180452877;
		(*leb).p[2]  = 0.7911019296;

		(*leb).N3 = 6;
		(*leb).D1 = D_Allocate_1D_Matrix ((*leb).N3);
		(*leb).r  = D_Allocate_1D_Matrix ((*leb).N3);
		(*leb).u  = D_Allocate_1D_Matrix ((*leb).N3);

		(*leb).D1[0] = 0.1555213603*1.0E-2;
		(*leb).D1[1] = 0.1802239128*1.0E-2;
		(*leb).D1[2] = 0.1849830560*1.0E-2;
		(*leb).D1[3] = 0.1713904507*1.0E-2;
		(*leb).D1[4] = 0.1802658934*1.0E-2;
		(*leb).D1[5] = 0.1842866472*1.0E-2;

		(*leb).r[0]  = 0.2778673190;
		(*leb).r[1]  = 0.5033564271;
		(*leb).r[2]  = 0.5984126497;
		(*leb).r[3]  = 0.3791035407;
		(*leb).r[4]  = 0.4742392842;
		(*leb).r[5]  = 0.5610263808;

		(*leb).u[0]  = 0.08213021581;
		(*leb).u[1]  = 0.08999205842;
		(*leb).u[2]  = 0.1816640840;
		(*leb).u[3]  = 0.1720795225;
		(*leb).u[4]  = 0.2634716655;
		(*leb).u[5]  = 0.3518280927;


		(*leb).N_check = 590;
	}
	else if ( (index1 == 47) && (index2 == 1) )
	{

		(*leb).A1 = 0.2192942090*1.0E-3;
		(*leb).A2 = 0.1436433617*1.0E-2;
		(*leb).A3 = 0.1421940344*1.0E-2;

		(*leb).N1 = 10;
		(*leb).Bk = D_Allocate_1D_Matrix ((*leb).N1);
		(*leb).mk = D_Allocate_1D_Matrix ((*leb).N1);
		(*leb).Bk[0] = 0.6798123510*1.0E-3;
		(*leb).Bk[1] = 0.9913184235*1.0E-3;
		(*leb).Bk[2] = 0.1180207833*1.0E-2;
		(*leb).Bk[3] = 0.1296599602*1.0E-2;
		(*leb).Bk[4] = 0.1365871427*1.0E-2;
		(*leb).Bk[5] = 0.1402988604*1.0E-2;
		(*leb).Bk[6] = 0.1418645563*1.0E-2;
		(*leb).Bk[7] = 0.1421376741*1.0E-2;
		(*leb).Bk[8] = 0.1423996475*1.0E-2;
		(*leb).Bk[9] = 0.1431554042*1.0E-2;

		(*leb).mk[0] = 0.9974086776;
		(*leb).mk[1] = 0.9847997535;
		(*leb).mk[2] = 0.9580366759;
		(*leb).mk[3] = 0.9153179504;
		(*leb).mk[4] = 0.8559019286;
		(*leb).mk[5] = 0.7796213195;
		(*leb).mk[6] = 0.6866444472;
		(*leb).mk[7] = 0.4523119203;
		(*leb).mk[8] = 0.3125213050;
		(*leb).mk[9] = 0.1601558034;

		(*leb).N2 = 3;
		(*leb).C1 = D_Allocate_1D_Matrix ((*leb).N2);
		(*leb).p  = D_Allocate_1D_Matrix ((*leb).N2);

		(*leb).C1[0] = 0.9254401499*1.0E-3;
		(*leb).C1[1] = 0.1250239995*1.0E-2;
		(*leb).C1[2] = 0.1394365843*1.0E-2;

		(*leb).p[0]  = 0.9894775374;
		(*leb).p[1]  = 0.9407768787;
		(*leb).p[2]  = 0.8457493051;

		(*leb).N3 = 9;
		(*leb).D1 = D_Allocate_1D_Matrix ((*leb).N3);
		(*leb).r  = D_Allocate_1D_Matrix ((*leb).N3);
		(*leb).u  = D_Allocate_1D_Matrix ((*leb).N3);

		(*leb).D1[0] = 0.1127089094*1.0E-2;
		(*leb).D1[1] = 0.1345753761*1.0E-2;
		(*leb).D1[2] = 0.1424957283*1.0E-2;
		(*leb).D1[3] = 0.1261523341*1.0E-2;
		(*leb).D1[4] = 0.1392547106*1.0E-2;
		(*leb).D1[5] = 0.1418761677*1.0E-2;
		(*leb).D1[6] = 0.1338366684*1.0E-2;
		(*leb).D1[7] = 0.1393700862*1.0E-2;
		(*leb).D1[8] = 0.1415914757*1.0E-2;

		(*leb).r[0]  = 0.2355187894;
		(*leb).r[1]  = 0.4102182474;
		(*leb).r[2]  = 0.6214302417;
		(*leb).r[3]  = 0.3245284345;
		(*leb).r[4]  = 0.5224482189;
		(*leb).r[5]  = 0.6017546634;
		(*leb).r[6]  = 0.4346575516;
		(*leb).r[7]  = 0.4908826589;
		(*leb).r[8]  = 0.5648768149;

		(*leb).u[0]  = 0.06944024393;
		(*leb).u[1]  = 0.2269004109;
		(*leb).u[2]  = 0.08025574608;
		(*leb).u[3]  = 0.1467999527;
		(*leb).u[4]  = 0.1571507769;
		(*leb).u[5]  = 0.2365702993;
		(*leb).u[6]  = 0.07714815866;
		(*leb).u[7]  = 0.3062936666;
		(*leb).u[8]  = 0.3822477379;


		(*leb).N_check = 770;
	}
	else if ( (index1 == 53) && (index2 == 1) )
	{

		(*leb).A1 = 0.1438294190*1.0E-3;
		(*leb).A2 = 0.0000000000;
		(*leb).A3 = 0.1125772288*1.0E-2;

		(*leb).N1 = 12;
		(*leb).Bk = D_Allocate_1D_Matrix ((*leb).N1);
		(*leb).mk = D_Allocate_1D_Matrix ((*leb).N1);

		(*leb).Bk[0]  = 0.4948029342*1.0E-3;
		(*leb).Bk[1]  = 0.7357990108*1.0E-3;
		(*leb).Bk[2]  = 0.8889132771*1.0E-3;
		(*leb).Bk[3]  = 0.9888347838*1.0E-3;
		(*leb).Bk[4]  = 0.1053299681*1.0E-2;
		(*leb).Bk[5]  = 0.1092778807*1.0E-2;
		(*leb).Bk[6]  = 0.1114389394*1.0E-2;
		(*leb).Bk[7]  = 0.1123724788*1.0E-2;
		(*leb).Bk[8]  = 0.1125239325*1.0E-2;
		(*leb).Bk[9]  = 0.1126153271*1.0E-2;
		(*leb).Bk[10] = 0.1130286931*1.0E-2;
		(*leb).Bk[11] = 0.1134986534*1.0E-2;

		(*leb).mk[0]  = 0.9981553450;
		(*leb).mk[1]  = 0.9888832243;
		(*leb).mk[2]  = 0.9688902204;
		(*leb).mk[3]  = 0.9366027304;
		(*leb).mk[4]  = 0.8912679426;
		(*leb).mk[5]  = 0.8325967237;
		(*leb).mk[6]  = 0.7605829053;
		(*leb).mk[7]  = 0.6754009691;
		(*leb).mk[8]  = 0.4668589056;
		(*leb).mk[9]  = 0.3446136542;
		(*leb).mk[10] = 0.2119541518;
		(*leb).mk[11] = 0.07162440144;


		(*leb).N2 = 4;
		(*leb).C1 = D_Allocate_1D_Matrix ((*leb).N2);
		(*leb).p  = D_Allocate_1D_Matrix ((*leb).N2);

		(*leb).C1[0] = 0.6823367927*1.0E-3;
		(*leb).C1[1] = 0.9454158160*1.0E-3;
		(*leb).C1[2] = 0.1074429975*1.0E-2;
		(*leb).C1[3] = 0.1129300086*1.0E-2;

		(*leb).p[0]  = 0.9923235654;
		(*leb).p[1]  = 0.9557815124;
		(*leb).p[2]  = 0.8827859807;
		(*leb).p[3]  = 0.7737784472;

		(*leb).N3 = 12;
		(*leb).D1 = D_Allocate_1D_Matrix ((*leb).N3);
		(*leb).r  = D_Allocate_1D_Matrix ((*leb).N3);
		(*leb).u  = D_Allocate_1D_Matrix ((*leb).N3);

		(*leb).D1[0]  = 0.8436884500*1.0E-3;
		(*leb).D1[1]  = 0.1075255720*1.0E-2;
		(*leb).D1[2]  = 0.1108577236*1.0E-2;
		(*leb).D1[3]  = 0.9566475323*1.0E-3;
		(*leb).D1[4]  = 0.1080663250*1.0E-2;
		(*leb).D1[5]  = 0.1126797131*1.0E-2;
		(*leb).D1[6]  = 0.1022568715*1.0E-2;
		(*leb).D1[7]  = 0.1108960267*1.0E-2;
		(*leb).D1[8]  = 0.1122790653*1.0E-2;
		(*leb).D1[9]  = 0.1032401847*1.0E-2;
		(*leb).D1[10] = 0.1107249382*1.0E-2;
		(*leb).D1[11] = 0.1121780048*1.0E-2;

		(*leb).u[0]   = 0.05974048614;
		(*leb).u[1]   = 0.1375760408;
		(*leb).u[2]   = 0.3391016526;
		(*leb).u[3]   = 0.1271675191;
		(*leb).u[4]   = 0.2693120740;
		(*leb).u[5]   = 0.1419786452;
		(*leb).u[6]   = 0.06709284600;
		(*leb).u[7]   = 0.07057738183;
		(*leb).u[8]   = 0.2783888477;
		(*leb).u[9]   = 0.1979578938;
		(*leb).u[10]  = 0.2087307061;
		(*leb).u[11]  = 0.4055122137;

		(*leb).r[0]  = 0.2029128752;
		(*leb).r[1]  = 0.4602621942;
		(*leb).r[2]  = 0.5030673999;
		(*leb).r[3]  = 0.2817606422;
		(*leb).r[4]  = 0.4331561291;
		(*leb).r[5]  = 0.6256167358;
		(*leb).r[6]  = 0.3798395216;
		(*leb).r[7]  = 0.5517505421;
		(*leb).r[8]  = 0.6029619156;
		(*leb).r[9]  = 0.3589606329;
		(*leb).r[10] = 0.5348666438;
		(*leb).r[11] = 0.5674997546;


		(*leb).N_check = 974;
	}
	else if ( (index1 == 131) && (index2 == 1) )
	{
		(*leb).A1 = 0.9735347946175486*1.0E-5;
		(*leb).A2 = 0.1907581241803167*1.0E-3;
		(*leb).A3 = 0.1901059546737578*1.0E-3;

		(*leb).N1 = 31;
		(*leb).Bk = D_Allocate_1D_Matrix ((*leb).N1);
		(*leb).mk = D_Allocate_1D_Matrix ((*leb).N1);

		(*leb).Bk[0]   = 0.3926424538919212*1.0E-4;
		(*leb).Bk[1]   = 0.6667905467294382*1.0E-4;
		(*leb).Bk[2]   = 0.8868891315019135*1.0E-4;
		(*leb).Bk[3]   = 0.1066306000958872*1.0E-3;
		(*leb).Bk[4]   = 0.1214506743336128*1.0E-3;
		(*leb).Bk[5]   = 0.1338054681640871*1.0E-3;
		(*leb).Bk[6]   = 0.1441677023628504*1.0E-3;
		(*leb).Bk[7]   = 0.1528880200826557*1.0E-3;
		(*leb).Bk[8]   = 0.1602330623773609*1.0E-3;
		(*leb).Bk[9]   = 0.1664102653445244*1.0E-3;
		(*leb).Bk[10]  = 0.1715845854011323*1.0E-3;
		(*leb).Bk[11]  = 0.1758901000133069*1.0E-3;
		(*leb).Bk[12]  = 0.1794382485256736*1.0E-3;
		(*leb).Bk[13]  = 0.1823238106757407*1.0E-3;
		(*leb).Bk[14]  = 0.1846293252959976*1.0E-3;
		(*leb).Bk[15]  = 0.1864284079323098*1.0E-3;
		(*leb).Bk[16]  = 0.1877882694626914*1.0E-3;
		(*leb).Bk[17]  = 0.1887716321852025*1.0E-3;
		(*leb).Bk[18]  = 0.1894381638175673*1.0E-3;
		(*leb).Bk[19]  = 0.1898454899533629*1.0E-3;
		(*leb).Bk[20]  = 0.1900497929577815*1.0E-3;
		(*leb).Bk[21]  = 0.1900671501924092*1.0E-3;
		(*leb).Bk[22]  = 0.1899837555533510*1.0E-3;
		(*leb).Bk[23]  = 0.1899014113156229*1.0E-3;
		(*leb).Bk[24]  = 0.1898581257705106*1.0E-3;
		(*leb).Bk[25]  = 0.1898804756095753*1.0E-3;
		(*leb).Bk[26]  = 0.1899793610426402*1.0E-3;
		(*leb).Bk[27]  = 0.1901464554844117*1.0E-3;
		(*leb).Bk[28]  = 0.1903533246259542*1.0E-3;
		(*leb).Bk[29]  = 0.1905556158463228*1.0E-3;
		(*leb).Bk[30]  = 0.1907037155663528*1.0E-3;

 		(*leb).mk[0]    = 0.9998601923168344;
 		(*leb).mk[1]    = 0.9990618867660807;
 		(*leb).mk[2]    = 0.9971552833460721;
 		(*leb).mk[3]    = 0.9938215431121217;
 		(*leb).mk[4]    = 0.9888276246368412;
 		(*leb).mk[5]    = 0.9820003253167888;
 		(*leb).mk[6]    = 0.9732098648471069;
 		(*leb).mk[7]    = 0.9623589141607676;
 		(*leb).mk[8]    = 0.9493750178821929;
 		(*leb).mk[9]    = 0.9342052126266969;
 		(*leb).mk[10]   = 0.9168121040589686;
 		(*leb).mk[11]   = 0.8971709355126096;
 		(*leb).mk[12]   = 0.8752673448020141;
 		(*leb).mk[13]   = 0.8510956091284314;
 		(*leb).mk[14]   = 0.8246572459190639;
 		(*leb).mk[15]   = 0.7959598846221919;
 		(*leb).mk[16]   = 0.7650163598669611;
 		(*leb).mk[17]   = 0.7318440059488363;
 		(*leb).mk[18]   = 0.6964641607316614;
 		(*leb).mk[19]   = 0.6589019174083282;
 		(*leb).mk[20]   = 0.6191861983533608;
 		(*leb).mk[21]   = 0.5334328643779589;
 		(*leb).mk[22]   = 0.4874801556221757;
 		(*leb).mk[23]   = 0.4395488504273442;
 		(*leb).mk[24]   = 0.3897107334283811;
 		(*leb).mk[25]   = 0.3380589036680602;
 		(*leb).mk[26]   = 0.2847157265697618;
 		(*leb).mk[27]   = 0.2298419930079757;
 		(*leb).mk[28]   = 0.1736458806923450;
 		(*leb).mk[29]   = 0.1163891637007593;
 		(*leb).mk[30]   = 0.0583872486171024;


		(*leb).N2 = 10;
		(*leb).C1 = D_Allocate_1D_Matrix ((*leb).N2);
		(*leb).p  = D_Allocate_1D_Matrix ((*leb).N2);

		(*leb).C1[0] = 0.5992997844249967*1.0E-4;
		(*leb).C1[1] = 0.9749059382456978*1.0E-4;
		(*leb).C1[2] = 0.1241680804599158*1.0E-3;
		(*leb).C1[3] = 0.1437626154299360*1.0E-3;
		(*leb).C1[4] = 0.1584200054793902*1.0E-3;
		(*leb).C1[5] = 0.1694436550982744*1.0E-3;
		(*leb).C1[6] = 0.1776617014018108*1.0E-3;
		(*leb).C1[7] = 0.1836132434440077*1.0E-3;
		(*leb).C1[8] = 0.1876494727075983*1.0E-3;
		(*leb).C1[9] = 0.1899906535336482*1.0E-3;

		(*leb).p[0]  = 0.9993687985262999;
		(*leb).p[1]  = 0.9958039950941233;
		(*leb).p[2]  = 0.9876589697048654;
		(*leb).p[3]  = 0.9740002903318313;
		(*leb).p[4]  = 0.9543081674461321;
		(*leb).p[5]  = 0.9283335847592317;
		(*leb).p[6]  = 0.8960221029877130;
		(*leb).p[7]  = 0.8574701520212813;
		(*leb).p[8]  = 0.8128985103667202;
		(*leb).p[9]  = 0.7626355787616330;

		(*leb).N3 = 100;
		(*leb).D1 = D_Allocate_1D_Matrix ((*leb).N3);
		(*leb).r  = D_Allocate_1D_Matrix ((*leb).N3);
		(*leb).u  = D_Allocate_1D_Matrix ((*leb).N3);

		for (i = 0; i < 100; i++)
		{
			(*leb).D1[i] = D1_131[i];
			(*leb).r[i]  = v_131[i];
			(*leb).u[i]  = u_131[i];
		}

		(*leb).N_check = 5810;
	}
	if (DEBUG)
	{
		fprintf(fp_debug, "Set_Lebedev_Grid_Parm before multiplying by 4*Pi\n");
		fprintf(fp_debug, "Grid %d.%d\n", index1, index2);
		fprintf(fp_debug, "\tA1 = %20.18f\n", (*leb).A1);
		fprintf(fp_debug, "\tA2 = %20.18f\n", (*leb).A2);
		fprintf(fp_debug, "\tA3 = %20.18f\n", (*leb).A3);


		fprintf(fp_debug, "\tN1 = %d\n", (*leb).N1);
		for (i = 0; i < (*leb).N1; i++)
			fprintf(fp_debug, "\t\tB1 = %20.18f   m = %20.18f\n", (*leb).Bk[i], (*leb).mk[i]);


		fprintf(fp_debug, "\tN2 = %d\n", (*leb).N2);
		for (i = 0; i < (*leb).N2; i++)
			fprintf(fp_debug, "\t\tC = %20.18f   p = %20.18f\n", (*leb).C1[i], (*leb).p[i]);

		fprintf(fp_debug, "\tN3 = %d\n", (*leb).N3);
		for (i = 0; i < (*leb).N3; i++)
			fprintf(fp_debug, "\t\tD = %20.18f   r = %20.18f u = %20.18f\n", (*leb).D1[i], (*leb).r[i], (*leb).u[i]);
	}

/*Multiply Weights by 4*Pi*/
	(*leb).A1 *= 4.0*Pi;
	(*leb).A2 *= 4.0*Pi;
	(*leb).A3 *= 4.0*Pi;
	for (i = 0; i < (*leb).N1; i++)
		(*leb).Bk[i] *= 4.0*Pi;
	for (i = 0; i < (*leb).N2; i++)
		(*leb).C1[i] *= 4.0*Pi;
	for (i = 0; i < (*leb).N3; i++)
		(*leb).D1[i] *= 4.0*Pi;
}



void Set_a1 (double a1[6][3])
/*a1[6][3]  sets 6 a1 vectors*/
{
	int i, j, p, count;
	
	for (i = 0; i < 6; i++)
		for (p = 0; p < 3; p++)
			a1[i][p] = 0.0;

	count = 0;
	for (i = 0; i < 3; i++)
		for (j = 0; j < 2; j++)
		{
			if (j == 0)
				a1[count][i] = 1.0;
			else
				a1[count][i] = -1.0;
			count++;
		}
}

void Set_a2 (double a2[12][3])
/*a2[12][3]  sets 12 a2 vectors*/
{
	int i, p, count;
	int i1, i2, i3, n1, n2;
	double constant;
	double pos_neg[2];

	pos_neg[0] =  1.0;
	pos_neg[1] = -1.0;

	constant = 1.0/sqrt(2.0);
	count = 0;
	for (i1 = 0; i1 < 3; i1++)
	{
		i2 = (i1+1)%3;
		i3 = (i1+2)%3;
		for (n1 = 0; n1 < 2; n1++)
			for (n2 = 0; n2 < 2; n2++)
			{
				a2[count][i1] = 0.0;	a2[count][i2] = constant*pos_neg[n1];	a2[count][i3] = constant*pos_neg[n2];
				count++;
			}
	}
}

void Set_a3 (double a3[8][3])
/*a3[8][3]  sets 8 a3 vectors*/
{
	int i, p, count;
	int n1, n2, n3;
	double constant;
	double pos_neg[2];

	pos_neg[0] =  1.0;
	pos_neg[1] = -1.0;

	constant = 1.0/sqrt(3.0);
	count = 0;
	for (n1 = 0; n1 < 2; n1++)
		for (n2 = 0; n2 < 2; n2++)
			for (n3 = 0; n3 < 2; n3++)
			{
				a3[count][0] = constant*pos_neg[n1];	a3[count][1] = constant*pos_neg[n2];	a3[count][2] = constant*pos_neg[n3];
				count++;
			}
}

void Set_bk (double bk[24][3], double mk)
/*bk[24][3]  sets 24 bk vectors*/
{
	int count;
	int n1, n2, n3;
	int i1, i2, i3;
	double pos_neg[2];
	double lk;

	lk = sqrt( (1.0 - mk*mk)/2.0);

	pos_neg[0] =  1.0;
	pos_neg[1] = -1.0;

	count = 0;
	for (i1 = 0; i1 < 3; i1++)
	{
		i2 = (i1+1)%3;
		i3 = (i1+2)%3;
		for (n1 = 0; n1 < 2; n1++)
			for (n2 = 0; n2 < 2; n2++)
				for (n3 = 0; n3 < 2; n3++)
				{
					bk[count][i1] = lk*pos_neg[n1];	bk[count][i2] = lk*pos_neg[n2];	bk[count][i3] = mk*pos_neg[n3];
					count++;
				}
	}
}

void Set_ck (double ck[24][3], double pk)
/*ck[24][3]  sets 24 ck vectors*/
{
	int count;
	int n1, n2, n3;
	int i1, i2, i3;
	double pos_neg[2];
	double qk;

	qk = sqrt(1.0 - pk*pk);

	pos_neg[0] =  1.0;
	pos_neg[1] = -1.0;
	count = 0;
	for (i1 = 0; i1 < 3; i1++)
	{
		i2 = (i1+1)%3;
		i3 = (i1+2)%3;
		for (n2 = 0; n2 < 2; n2++)
			for (n3 = 0; n3 < 2; n3++)
			{
				ck[count][i1] = 0.0;	ck[count][i2] = pk*pos_neg[n2];	ck[count][i3] = qk*pos_neg[n3];
				count++;
			}
	}
	for (i1 = 0; i1 < 3; i1++)
	{
		i2 = (i1+1)%3;
		i3 = (i1+2)%3;
		for (n2 = 0; n2 < 2; n2++)
			for (n3 = 0; n3 < 2; n3++)
			{
				ck[count][i1] = 0.0;	ck[count][i2] = qk*pos_neg[n2];	ck[count][i3] = pk*pos_neg[n3];
				count++;
			}
	}
}

void Set_dk (double dk[48][3], double rk, double uk)
/*dk[48][3]  sets 48 ck vectors*/
{
	int count;
	int n1, n2, n3;
	int i1, i2, i3;
	double pos_neg[2];
	double wk;

	wk = sqrt(1.0 - rk*rk - uk*uk);

	pos_neg[0] =  1.0;
	pos_neg[1] = -1.0;

	count = 0;
	for (i1 = 0; i1 < 3; i1++)
	{
		i2 = (i1+1)%3;
		i3 = (i1+2)%3;
		for (n1 = 0; n1 < 2; n1++)
			for (n2 = 0; n2 < 2; n2++)
				for (n3 = 0; n3 < 2; n3++)
				{
					dk[count][i1] = rk*pos_neg[n1];	dk[count][i2] = uk*pos_neg[n2];	dk[count][i3] = wk*pos_neg[n3];
					count++;

					dk[count][i1] = rk*pos_neg[n1];	dk[count][i2] = wk*pos_neg[n2];	dk[count][i3] = uk*pos_neg[n3];
					count++;
				}
	}

}

double Set_v_2_p (double v)
{
	double p2;

	p2 = (1.0 + sqrt(1.0-4.0*v))/2.0;
	return sqrt(p2);
}

void Debug_Lebedev_Grid (int DEBUG, FILE *fp_debug)
{
	double a1[6][3];
	double a2[12][3];
	double a3[8][3];
	double bk[24][3];
	double ck[24][3];
	double dk[48][3];
	int i, j, p;
	double m1;
	double p1;
	double v1;
	int n_pt;
	double **r2d;
	double *weight;
	double mag;
	double r, u;
	double diff;

	struct LEB_Data leb;

	if (DEBUG == 0)
		return;



	Set_a1 (a1);
	fprintf(fp_debug, "\n\na1 vectors\n");
	for (i = 0; i < 6; i++)
		fprintf(fp_debug, "\ta1[%3d] = %8.4f %8.4f %8.4f\n", i, a1[i][0], a1[i][1], a1[i][2]);


	Set_a2 (a2);
	fprintf(fp_debug, "\n\na2 vectors\n");
	for (i = 0; i < 12; i++)
		fprintf(fp_debug, "\ta2[%3d] = %8.4f %8.4f %8.4f\n", i, a2[i][0], a2[i][1], a2[i][2]);

	Set_a3 (a3);
	fprintf(fp_debug, "\n\na3 vectors\n");
	for (i = 0; i < 8; i++)
		fprintf(fp_debug, "\ta3[%3d] = %8.4f %8.4f %8.4f\n", i, a3[i][0], a3[i][1], a3[i][2]);

	m1 = sqrt(13.0/15.0);
	Set_bk (bk, m1);
	fprintf(fp_debug, "\n\nbk vectors m1 = %f\n", m1);
	for (i = 0; i < 24; i++)
		fprintf(fp_debug, "\tbk[%3d] = %8.4f %8.4f %8.4f\n", i, bk[i][0], bk[i][1], bk[i][2]);

	v1 = 2.0/15.0;
	p1 = Set_v_2_p (v1);
	Set_ck (ck, p1);
	fprintf(fp_debug, "\n\nck vectors p1 = %f\n", p1);
	for (i = 0; i < 24; i++)
		fprintf(fp_debug, "\tck[%3d] = %8.4f %8.4f %8.4f\n", i, ck[i][0], ck[i][1], ck[i][2]);


	r = 0.836036015482;
	u = 0.159041710538;
	Set_dk (dk, r, u);
	fprintf(fp_debug, "\n\ndk vectors r = %f u = %f\n", r, u);
	for (i = 0; i < 48; i++)
		fprintf(fp_debug, "\tdk[%3d] = %8.4f %8.4f %8.4f\n", i, dk[i][0], dk[i][1], dk[i][2]);

/*check to see if all dk are distinct*/
	for (i = 0; i < 48; i++)
		for (j = 0; j < i; j++)
		{
			diff = 0;
			for (p = 0; p < 3; p++)
				diff += (dk[i][p] - dk[j][p])*(dk[i][p] - dk[j][p]);
			if (diff < 1.0E-8)
			{
				printf("ERROR: dk vectors are distinct for %d and %d\n", i, j);
				fprintf(stdout, "\tdk[%3d] = %8.4f %8.4f %8.4f\n", i, dk[i][0], dk[i][1], dk[i][2]);
				fprintf(stdout, "\tdk[%3d] = %8.4f %8.4f %8.4f\n", j, dk[j][0], dk[j][1], dk[j][2]);
				exit(0);
			}
		}

	fprintf(fp_debug, "Getting 23.1 Grid\n");
	Set_Lebedev_Grid_Parm (23, 1, &leb, DEBUG, fp_debug);
	Calc_Lebedev_Grid (&n_pt, &r2d, &weight, &leb);

/*Make sure all points are on a unit sphere*/
	fprintf(fp_debug, "n_pt = %d\n", n_pt);
	for (i = 0; i < n_pt; i++)
	{
		mag = sqrt(dot_prod (r2d[i], r2d[i]));
		fprintf(fp_debug, "\t%10.6f %10.6f %10.6f   r2 = %10.6f   weight = %15.10f\n", r2d[i][0], r2d[i][1], r2d[i][2], mag, weight[i]);
	}

}



			
void Calc_Lebedev_Grid (int *n_pt, double ***r2d, double **weight, struct LEB_Data *leb)
/*Calculates Lebedev Angular Grid*/
{
	double a1[6][3];
	double a2[12][3];
	double a3[8][3];
	double bk[24][3];
	double ck[24][3];
	double dk[48][3];
	int n, i, p, count;


	(*n_pt) = 0;
	if (fabs((*leb).A1) > 1.0E-10)
		(*n_pt) += 6;
	if (fabs((*leb).A2) > 1.0E-10)
		(*n_pt) += 12;
	if (fabs((*leb).A3) > 1.0E-10)
		(*n_pt) += 8;
	for (n = 0; n < (*leb).N1; n++)
		if (fabs((*leb).Bk[n]) > 1.0E-10)
			(*n_pt) += 24;
	for (n = 0; n < (*leb).N2; n++)
		if (fabs((*leb).C1[n]) > 1.0E-10)
			(*n_pt) += 24;
	for (n = 0; n < (*leb).N3; n++)
		if (fabs((*leb).D1[n]) > 1.0E-10)
			(*n_pt) += 48;

	if ((*leb).N_check != (*n_pt) )
	{
		printf("ERROR in Calc_Lebedev_Grid.. N_check = %d != n_pt = %d\n", (*leb).N_check, (*n_pt) );
		exit(0);
	}


	(*r2d)    = D_Allocate_2D_Matrix ((*n_pt), 3);
	(*weight) = D_Allocate_1D_Matrix ((*n_pt) );

	Set_a1 (a1);
	Set_a2 (a2);
	Set_a3 (a3);

	count = 0;
	if (fabs((*leb).A1) > 1.0E-10)
	{
		for (i = 0; i < 6; i++)
		{
			for (p = 0; p < 3; p++)
				(*r2d)[count][p] = a1[i][p];
			(*weight)[count] = (*leb).A1;
			count++;
		}
	}
	if (fabs((*leb).A2) > 1.0E-10)
	{
		for (i = 0; i < 12; i++)
		{
			for (p = 0; p < 3; p++)
				(*r2d)[count][p] = a2[i][p];
			(*weight)[count] = (*leb).A2;
			count++;
		}
	}
	if (fabs((*leb).A3) > 1.0E-10)
	{
		for (i = 0; i < 8; i++)
		{
			for (p = 0; p < 3; p++)
				(*r2d)[count][p] = a3[i][p];
			(*weight)[count] = (*leb).A3;
			count++;
		}
	}
	for (n = 0; n < (*leb).N1; n++)
		if (fabs((*leb).Bk[n]) > 1.0E-10)
		{
			Set_bk (bk, (*leb).mk[n]);
			for (i = 0; i < 24; i++)
			{
				for (p = 0; p < 3; p++)
					(*r2d)[count][p] = bk[i][p];
				(*weight)[count] = (*leb).Bk[n];
				count++;
			}
		}

	for (n = 0; n < (*leb).N2; n++)
		if (fabs((*leb).C1[n]) > 1.0E-10)
		{
			Set_ck (ck, (*leb).p[n]);
			for (i = 0; i < 24; i++)
			{
				for (p = 0; p < 3; p++)
					(*r2d)[count][p] = ck[i][p];
				(*weight)[count] = (*leb).C1[n];
				count++;
			}
		}
	for (n = 0; n < (*leb).N3; n++)
		if (fabs((*leb).D1[n]) > 1.0E-10)
		{
			Set_dk (dk, (*leb).r[n], (*leb).u[n]);
			for (i = 0; i < 48; i++)
			{
				for (p = 0; p < 3; p++)
					(*r2d)[count][p] = dk[i][p];
				(*weight)[count] = (*leb).D1[n];
				count++;
			}
		}
}

